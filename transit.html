<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>paravostok transit hub</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="site-header">
    <div class="wrapper">
      <h1 class="site-title">paravostok transit</h1>
      <p class="site-subtitle">buses, trams, trains, stats</p>
    </div>
  </header>

  <main class="wrapper">

    <!-- mileage section -->
    <section class="block-section">
      <h2 class="block-title">May Distance 2025</h2>
      <ul>
        <li><strong>total distance:</strong> 1,359 Miles</li>
        <li><strong>public transport:</strong> 1,237 Miles</li>
        <li><strong>walking:</strong> 93 Miles </li>
        <li><strong>driving:</strong> 29 Miles</li>
      </ul>
      <p><a href="stats/2025.html" class="read-more">see detailed stats →</a></p>
    </section>

    <!-- latest blog posts -->
    <section class="block-section">
      <h2 class="block-title">latest blog posts</h2>
      <div id="recent-posts">loading…</div>
    </section>

  </main>

  <footer class="site-footer">
    <div class="wrapper">
      <p>last updated: 2025-06-02</p>
    </div>
  </footer>

  <script>
    async function loadRecentPosts() {
      const postsContainer = document.getElementById('recent-posts');
      const response = await fetch('/posts/');
      const text = await response.text();

      const parser = new DOMParser();
      const doc = parser.parseFromString(text, 'text/html');

      const links = [...doc.querySelectorAll('a')].map(a => a.getAttribute('href'));
      const htmlFiles = links.filter(name => name.endsWith('.html'));

      const sorted = htmlFiles
        .map(name => ({
          name,
          date: new Date(name.replace('.html', '').split('.').reverse().join('-'))
        }))
        .sort((a, b) => b.date - a.date)
        .slice(0, 3);

      for (const post of sorted) {
        const postHtml = await fetch(`/posts/${post.name}`).then(r => r.text());
        const postDoc = parser.parseFromString(postHtml, 'text/html');

        const title = postDoc.querySelector('h1')?.textContent || post.name;
        const excerpt = postDoc.querySelector('p')?.textContent || '';

        postsContainer.innerHTML += `
          <div class="post-preview">
            <h3 class="post-title">${title}</h3>
            <p class="post-excerpt">${excerpt}</p>
            <a href="/posts/${post.name}" class="read-more">read more →</a>
          </div>
        `;
      }

      postsContainer.innerHTML += `<p><a href="/posts/${sorted[0].name}" class="read-more">see all posts →</a></p>`;
    }

    loadRecentPosts();
  </script>
</body>
</html>
